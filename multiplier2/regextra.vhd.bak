library IEEE;
use IEEE.std_logic_1164.all;

entity sr_reg is
generic (K : integer := 4);
port (clk, carga, sh, in_sh: in std_logic;
      d: in std_logic_vector (K-1 downto 0);
      q: inout std_logic_vector(K-1 downto 0));
end sr_reg;

architecture comportamento of sr_reg is
signal e: std_logic_vector(K-1 downto 0);
begin

 process (clk)
 begin
    if (clk'event and clk = '1' and carga = '1') then
        q <= d;
    elsif (clk'event and clk = '1' and sh = '1' and carga = '0') THEN
        q <= in_sh & e (K-1 downto 1);

    end if;
  end process;
        e <= q;
end comportamento;
